scp -i ~/Documents/conf/dessage-rbc TweetCatApp.dmg ribencong@35.247.142.146:~/



test script

chrome.runtime.sendNativeMessage(
  'com.dessage.tweetcatapp',
  { action: 'start', videoId: '' },
  resp => console.log('resp(start)=', resp, 'lastError=', chrome.runtime.lastError)
);


chrome.runtime.sendNativeMessage(
  'com.dessage.tweetcatapp',
  {
    action: 'cookie',
    videoId: 'abc123',
    url: 'https://www.youtube.com/watch?v=abc123',
    cookies: [
      { name: 'SID', value: 'dummy123', domain: '.youtube.com', path: '/' }
    ]
  },
  resp => console.log('resp(cookie)=', resp, 'lastError=', chrome.runtime.lastError)
);


chrome.runtime.sendNativeMessage(
  'com.dessage.tweetcatapp',
  { action: 'check', videoId: '' },
  resp => console.log('resp(check)=', resp, 'lastError=', chrome.runtime.lastError)
);


function readKolInCategory(catID) {
  const dbName = "tweet-cat-database";
  const storeName = "__table_kol_in_category__";

  return new Promise((resolve, reject) => {
    const openReq = indexedDB.open(dbName);

    openReq.onerror = function (event) {
      console.error("打开数据库失败:", event.target.error);
      reject(event.target.error);
    };

    openReq.onsuccess = function (event) {
      const db = event.target.result;
      const tx = db.transaction(storeName, "readonly");
      const store = tx.objectStore(storeName);

      const getAllReq = store.getAll();
      getAllReq.onerror = function (event) {
        console.error("查询失败:", event.target.error);
        reject(event.target.error);
      };

      getAllReq.onsuccess = function () {
        let results = getAllReq.result;

        if (catID > 0) {
          results = results.filter(item => item.catID === catID);
        } else if (catID !== -1) {
          console.warn("请输入 -1 或者大于 0 的 catID");
          resolve("");
          return;
        }

        const kolNames = results
          .map(item => `@${item.kolName}`)
          .join(", ");

        console.log("结果字符串:", kolNames);
        resolve(kolNames);
      };
    };
  });
}

// 用法：
// await readKolInCategory(-1)   // 查询全部
// await readKolInCategory(2)    // 查询 catID=2 的所有 kolName 拼接字符串